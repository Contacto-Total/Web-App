<!-- edit-combo-dialog.component.html -->
<form [formGroup]="form" class="dlg" (ngSubmit)="save()" novalidate>
  <header class="dlg__head">
    <h2>Editar combo</h2>
    <button type="button" class="icon-btn" (click)="close()" aria-label="Cerrar">✕</button>
  </header>

  <section class="dlg__body">
    <!-- Obligatorios -->
    <div class="grid">
      <div class="full">
        <label>Nombre</label>
        <input formControlName="nombre" type="text" placeholder="Nombre del combo" />
      </div>

      <div class="full">
        <div class="row-between">
          <label>Texto de SMS (Plantilla) <span class="req">*</span></label>
          <small class="muted">{{ smsLength() }}/{{ SMS_MAX }}</small>
        </div>
        <textarea formControlName="plantillaTexto" rows="5" placeholder="Hola {NOMBRE}, …"></textarea>
        <div class="error" *ngIf="smsCtrl.invalid && (smsCtrl.dirty || submitted)">
        El texto es obligatorio.
        </div>
      </div>
    </div>

    <!-- Avanzado colapsable -->
    <details class="adv">
      <summary>Opciones avanzadas</summary>

      <div class="grid">
        <div>
          <label>Tramo</label>
          <select formControlName="tramo">
            <option value="3">Tramo 3</option>
            <option value="5">Tramo 5</option>
          </select>
        </div>

        <div>
          <label>Restricciones</label>
          <div class="checks">
            <label><input type="checkbox" formControlName="excluirPromesasPeriodoActual" /> Excluir promesas periodo</label>
            <label><input type="checkbox" formControlName="excluirCompromisos" /> Excluir compromisos</label>
            <label><input type="checkbox" formControlName="excluirBlacklist" /> Excluir blacklist</label>
          </div>
        </div>

        <div class="full">
          <label>Selects</label>
          <div class="chips">
            <button type="button" class="chip" [class.active]="hasSelect('NOMBRE')" (click)="onChipClick($event,'NOMBRE')">Nombre</button>
            <button type="button" class="chip" [class.active]="hasSelect('LTD')" (click)="onChipClick($event,'LTD')">LTD</button>
            <button type="button" class="chip" [class.active]="hasSelect('LTDE')" (click)="onChipClick($event,'LTDE')">LTDE</button>
            <button type="button" class="chip" [class.active]="hasSelect('LTD_LTDE')" (click)="onChipClick($event,'LTD_LTDE')">LTD + LTDE</button>
            <button type="button" class="chip" [class.active]="hasSelect('BAJA30')" (click)="onChipClick($event,'BAJA30')">Baja 30</button>
            <button type="button" class="chip" [class.active]="hasSelect('SALDO_MORA')" (click)="onChipClick($event,'SALDO_MORA')">Mora</button>
            <button type="button" class="chip" [class.active]="hasSelect('BAJA30_SALDOMORA')" (click)="onChipClick($event,'BAJA30_SALDOMORA')">Baja30 + Mora</button>
            <button type="button" class="chip" [class.active]="hasSelect('CAPITAL')" (click)="onChipClick($event,'CAPITAL')">Capital</button>
            <button type="button" class="chip" [class.active]="hasSelect('DEUDA_TOTAL')" (click)="onChipClick($event,'DEUDA_TOTAL')">Deuda Total</button>
            <button type="button" class="chip" [class.active]="hasSelect('PKM')" (click)="onChipClick($event,'PKM')">PKM</button>
            <button type="button" class="chip" [class.active]="hasSelect('HOY')" (click)="onChipClick($event,'HOY')">Hoy</button>
            <button type="button" class="chip" [class.active]="hasSelect('MANANA')" (click)="onChipClick($event,'MANANA')">Mañana</button>

          </div>
        </div>
      </div>
    </details>

    <!-- (Descripción la dejamos fuera; si la quieres, ponla en este bloque) -->
  </section>

  <footer class="dlg__foot">
    <button type="button" mat-button (click)="close()">Cancelar</button>
    <button type="submit" mat-raised-button color="primary" [disabled]="form.invalid || saving">
      {{ saving ? 'Guardando…' : 'Guardar' }}
    </button>
  </footer>
</form>
